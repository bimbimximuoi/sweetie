<!DOCTYPE html>
<html>
<head>
    <title>Sign In</title>
    <!-- Firebase App (the core Firebase SDK) is always required and must be listed first -->
    <script src="https://www.gstatic.com/firebasejs/8.9.1/firebase-app.js"></script>
    <!-- Add Firebase products that you want to use -->
    <script src="https://www.gstatic.com/firebasejs/8.9.1/firebase-auth.js"></script>
    <script>
        // Your web app's Firebase configuration
        var firebaseConfig = {
            apiKey: "AIzaSyBqaF_0sewu2zB1w8yMfx7ePHOhF6221KY",
            authDomain: "sweetie-a7fb2.firebaseapp.com",
            projectId: "sweetie-a7fb2",
            storageBucket: "sweetie-a7fb2.appspot.com",
            messagingSenderId: "1046992011333",
            appId: "1:1046992011333:web:b63930e6e07aa1fdb5232c"
        };
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
    </script>
</head>
<body>
    <Button id="googleSignIn" class="bg-background-dark text-white font-bold py-2 px-4 rounded mt-4 inline-block">Sign in with Google</Button>
    <script>
        // Initialize Firebase Authentication and get a reference to the service
        const auth = firebase.auth();

        document.getElementById('googleSignIn').addEventListener('click', function() {
            var provider = new firebase.auth.GoogleAuthProvider();
            auth.signInWithPopup(provider).then((result) => {
                // This gives you a Google Access Token. You can use it to access the Google API.
                var token = result.credential.accessToken;
                // The signed-in user info.
                var user = result.user;
                console.log('User:', user);

                // Send ID token to backend
                user.getIdToken().then(idToken => {
                    fetch('/auth/signin/google', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ idToken })
                    }).then(response => response.json())
                      .then(data => {
                          if (data.success) {
                              console.log('User verified');
                              // Redirect or perform any further actions after successful sign in
                          } else {
                              console.log('Verification failed');
                          }
                      });
                });
            }).catch((error) => {
                console.error('Error:', error);
            });
        });
    </script>
</body>
</html>
